<p id="notice"><%= notice %></p>

<div class="well well-green">
  <span class="md-font mr20">今月の人</span>
  <% @user_with_progress_points.first(3).each_with_index do |pp, i| %>
   <span class="label label-success md-font mr5"><%= i + 1 %>位</span>
   <span class="lg-font"  ><%= pp.user_name %></span>
   <span class="badge mr20"><%= pp.progress_points %></span>
  <% end %>
  <%= link_to 'みんなの成長', report_progresses_path, class: "btn btn-success btn-sm pull-right" %>
</div>

<br>

<%= search_form_for @q, :html => {:class => "form-inline"} do |f| %>
  <%= f.label :tag_cont, 'タグ' %>
  <%= f.text_field :tag_cont, :class => 'form-control' %>
  <%= f.label :title_cont, 'タイトル' %>
  <%= f.text_field :title_cont, :class => 'form-control' %>
  <%= f.label :user_id_eq, 'ユーザー' %>
	<%= f.collection_select :user_id_eq, User.all, :id, :name, {include_blank: true}, class: 'form-control' %>
  <br><br>
  <%= f.label :updated_at, '更新日' %>
  <%= f.date_field :updated_at_gteq, :class => 'form-control', :value => 7.day.ago.strftime('%Y-%m-%d') %>
  〜
  <% # http://qiita.com/LuckOfWise/items/e020e896e71d47d0c6a4 %>
  <%= f.date_field :updated_at_lteq_end_of_day, class: 'form-control', :value => 0.day.ago.strftime('%Y-%m-%d') %>
  <%= f.submit '検索', :class => 'btn btn-info pull-right' %>
<% end %>
<br>

<div class="table-responsive">
  <table class="table table-striped table-bordered">
    <thead>
      <tr>
        <th><%= sort_link(@q, :progress_points, '成長') %></th>
        <th><%= sort_link(@q, :comment_num, 'コメント') %></th>
        <th><%= sort_link(@q, :tag, 'タグ') %></th>
        <th><%= sort_link(@q, :title, 'タイトル') %></th>
        <!-- <th><%= sort_link(@q, :user_name, '内容(1行目)') %></th> -->
        <th><%= sort_link(@q, :user_name, 'ユーザー') %></th>
        <th><%= sort_link(@q, 'attachments_name', '添付ファイル') %></th>
        <!-- <th>Created at</th> -->
        <th><%= sort_link(@q, :updated_at, '更新日時') %></th>
        <th>操作</th>
      </tr>
    </thead>

    <tbody>
      <% @reports.each do |report| %>
        <tr>
          <td><%= report.progress_points %></td>
          <td><%= report.comment_num %></td>
          <td><%= report.tag %></td>
          <td><%= report.title %></td>
          <!-- <td><%= report.content.split[0] %></td> -->
          <td><%= report.user.name %></td>
          <td>
            <% report.attachments.each { |a| %>
            <%= a.name %><br>
            <% } %>
          </td>
          <!-- <td><%= report.created_at.strftime("%Y/%m/%d %H:%M") %></td> -->
          <td><%= report.updated_at.strftime("%Y/%m/%d %H:%M") %></td>
          <td>
						<%= link_to '参照', report, class: "btn btn-info" %>
						<% if report.user_id == current_user.id %> 
							<%= link_to '更新', edit_report_path(report), class: "btn btn-primary"  %>
							<%= link_to '削除', report, method: :delete, data: { confirm: '削除しますか?' }, class: "btn btn-warning" %>
						<% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<br>
<%= link_to '作成', new_report_path, class: "btn btn-primary" %>
