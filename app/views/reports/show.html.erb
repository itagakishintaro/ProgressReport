<p id="notice"><%= notice %></p>

<% if @report.user_id == current_user.id %> 
  <div class="text-right">
    <%= link_to '更新', edit_report_path(@report), class: "btn btn-primary margin-right-md"  %>
    <%= link_to '削除', @report, method: :delete, data: { confirm: '削除しますか?' }, class: "btn btn-warning" %>
  </div>
<% end %>

<div class="margin-bottom-sm">
  <span class="label label-default">タグ</span>
  <% @report.tag.split(",").each { |tag| %>
  <%= tag %>
  <% } %>
  <span>
    <span class="label label-default">ユーザー</span>
    <%= @report.user.name %>
  </span>
  <span>
    <span class="label label-default">作成日時</span>
    <%= @report.created_at.strftime("%Y/%m/%d %H:%M") %>
  </span>
  <span>
    <span class="label label-default">更新日時</span>
    <%= @report.updated_at.strftime("%Y/%m/%d %H:%M") %>
  </span>
</div>
<div id="title-view">
  <%= @report.title %>
</div>

<div id="content-view">
  <%= @report.content %>
</div>
<br>
<div>
  <% if @report.attachments.presence %>
    <% @report.attachments.each do |a| %>
      <span class="nowrap">
        <%= a.name %>
        <%= link_to 'ダウンロード', { action: :download, id: a[:id] }, class: 'btn btn-default btn-xs margin-right-md' %>
      </span>
    <% end %>
  <% end %>
</div>

<hr>

<span class="label label-default">コメント</span>
<div class="row">
  <div class="col-md-6 comments">
    <% @report.comments.each do |c| %>
    <div class="comment">
      <span class="time"><%= c.updated_at.strftime("%Y/%m/%d %H:%M") %></span>
      <span class="name"><%= c.user.name %></span>
      <span><%= auto_link(simple_format(h(c.comment))) %></span>
    </div>
    <% end %>
  </div>
  <div class="col-md-6">
    <%= form_tag('/comments', :method => :post) do %>
      <div class="field form-group">
        <%= text_area :comment, :comment, class: "form-control", placeholder: "コメントする..." %>
        <%= hidden_field :comment, :report_id, value: @report.id %>
        <%= hidden_field :comment, :user_id, value: current_user.id %>
        <%= submit_tag "送信", class: "btn btn-sm btn-info margin-top-sm" %>
      </div>
    <% end %>
  </div>
</div>

<br><br>

<%= link_to '戻る', reports_path, class: "btn btn-default pull-left margin-right-md" %>
<%= link_to '成長したね！', progresses_path( progress: {point:1, report_id:@report.id, user_id:current_user.id} ), method: :post, class: "btn btn-success pull-left" %>
<div class="arrow_box pull-left"><%= @report.progresses.map{|item| item.point}.sum %></div>

<br><br>